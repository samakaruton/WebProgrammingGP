<!DOCTYPE html> 
<html lang="en"> 
    <head> 
        <meta charset="UTF-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <title>Player Registration</title> 
    </head>
    <style>
        tr, th, td{
            padding: 14px;
        }

        th{
            background-color: #ff69b4;
        }

        body {
            font-family: 'Arial Rounded', sans-serif;
            background-color: #f0f8ff; /* Soft blue background */
            color: #333; /* Darker text for readability */
        }

        h1, h2 {
            color: #4a86e8; /* Soft blue for headings */
            text-align: center;
        }

        button {
            background-color: #ff69b4; /* Soft pink */
            border: none;
            border-radius: 15px;
            padding: 10px 20px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #ff85c1; /* Slightly lighter pink on hover */
        }

        input, select {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
            width: calc(100% - 22px); /* Full width with padding */
        }

        .centered-content {
            text-align: center;
            margin-top: 20px;
        }

        .chart-container {
            margin-top: 20px;
            border: 2px solid #4a86e8;
            padding: 10px;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            background-color: #e6e6fa; /* Light purple for list items */
            margin-bottom: 5px;
            padding: 10px;
            border-radius: 5px;
        }

    </style> 
    <body> 
        <center>
            <h1>Player Registration</h1> 
            <form id="registerForm"> 
                <label for="firstName">First Name:</label><br> 
                <input type="text" id="firstName" name="firstName" required minlength="4"><br> 
                <label for="lastName">Last Name:</label><br> 
                <input type="text" id="lastName" name="lastName" required minlength="4"><br> 
                <label for="dob">Date of Birth:</label><br> 
                <input type="date" id="dob" name="dob" required ><br> 
                <label for="age">Age:</label><br> 
                <input type="number" id="age" name="age" disabled><br> 
                <label for="gender">Gender:</label><br> 
                <select id="gender" name="gender" required> 
                    <option value="">Select...</option> 
                    <option value="male">Male</option> 
                    <option value="female">Female</option> 
                </select><br> 
                <label for="email">Email:</label><br> 
                <input type="email" id="email" name="email" required pattern=".+@gmail.com$"><br> 
                <button type="button" id="registerButton" onclick="Register()">Register</button> 
                <button type="button" id="endButtonForm" onclick="endGame()">End</button>
            </form> <br><br>
            <button type="button" id="startButton" disabled onclick="PlayGame()">Start</button> 
            <button type="button" id="endButton" disabled>End</button>
            <button type="button" id="percentageScoreButton">PercentageScore</button>
            <br><br>
            <!--Task -->
            <div id="showallplayers" style="margin-top: 20px; border: 1px solid #000; padding: 10px;">
                <h2>All Registered Players</h2>
            </div>
   
            <div id="gamearea" style="display:none; width: 60%; height: 1200px; border: 2px solid #000;" disabled>
                <p>Calculate:</p>
                <span id="num1"></span> x <span id="num2"></span> = <input type="number" id="answerInput" min="0" required>
                <!--Task 7 Ysande Allen-->
                <button id="acceptButton" onclick="CheckAnswer()">CheckAnswer</button>
                <p id="result"></p>
                <!--Task 8 Ysande Allen-->
                <button id="nextButton" onclick="PlayGame()">Next</button>
                <!--Task 9 Ysande Allen-->
                <div id="stats" style="margin-top: 20px;">
                    <table id="showpercentage" style="border: 1px solid;">
                        <caption>Scoreboard</caption>
                        <tr>
                            <th>Rank</th>
                            <th>Name</th>
                            <th>Current Score</th>
                            <th>Correct Answers</th>
                            <th>Incorrect Answers</th>
                        </tr>
                        <tr>
                            <td>1</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>6</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>7</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>8</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>9</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>10</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </table>
                </div>
            </div>

            

            <br><br>
            <button type="button" id="accept" disabled style="display:none;">Accept</button><br>
            <button type="button" id="next" disabled style="display:none;">Next</button>
            
        </center>

            <!--Task 15  -  Gabrielle Flash-->
            <div id="genderChart" class="chart-container"></div>
            <div id="percentageChart" class="chart-container"></div>
        
    </body>
    <script>
        // A global storage entity for the registered players.
        let PlayerRegistrationData = [];

        //Getting the elements needed to calculate the age of the user
        let today = new Date();
        let dd = String(today.getDate()).padStart(2, '0');
        let mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
        let yyyy = today.getFullYear();

        today = yyyy + '-' + mm + '-' + dd;

        document.getElementById('dob').setAttribute('max', today);

        //Function that will calculate the age of the user and add it to the dedicated field
        function CalculateAge(){
            let dob = new Date(document.getElementById('dob').value);
            let today = new Date();
            let age = today.getFullYear() - dob.getFullYear();
            let monthDiff = today.getMonth() - dob.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
                age--;
            }

            document.getElementById('age').value = age;
        }

        document.getElementById('dob').addEventListener('change',CalculateAge);

        function enableButtons(){
            document.getElementById('startButton').disabled = false;
            document.getElementById('endButton').disabled = false;
        }

        //Register function
        function Register() {
            // Fetch the entered values from the form.
            let firstName = document.getElementById('firstName').value;
            let lastName = document.getElementById('lastName').value;
            let dob = document.getElementById('dob').value;
            let age = document.getElementById('age').value;
            let gender = document.getElementById('gender').value;
            let email = document.getElementById('email').value;

            // Perform basic validation checks on the entered values.
            if (!firstName || !lastName || !dob || !gender || !email) {
                alert('All fields are required. Please fill all the details.');
                return;
            }

            if (age < 8 || age > 12) {
                alert('Age must be between 8 and 12 inclusive.');
                return;
            }

            if (firstName.length < 3 || lastName.length < 3) {
                alert('First and Last Name must be more than three (3) characters in length.');
                return;
            }

            if (!email.endsWith('@gmail.com' || !email.endsWith('@GMAIL.COM'))) {
                alert('Email address must be validated to only accept email addresses that ends with “@gmail.com”.');
                return;
            }

            // Create an object to store the validated registration details.
            let playerDetails = {
                firstName: firstName,
                lastName: lastName,
                dob: dob,
                age: age,
                gender: gender,
                email: email,
                responses: []
            };

            // Append the validated player details to the global storage entity.
            PlayerRegistrationData.push(playerDetails);
            localStorage.setItem("PlayerRegistrationData",JSON.stringify(PlayerRegistrationData));

            // Display a confirmation message to the user.
            alert('Player registered successfully!');
            enableButtons();

            let fname = document.getElementById('firstName');
            let lname = document.getElementById('lastName');
            let birth = document.getElementById('dob');
            let g = document.getElementById('gender');
            let em = document.getElementById('email');

            if(fname.value && lname.value && birth.value && g.value && em.value){
                fname.disabled = true;
                lname.disabled = true;
                birth.disabled = true;
                g.disabled = true;
                em.disabled = true;
            }

            document.getElementById('registerButton').disabled = true;
            displayAllPlayers();

        }

        //document.getElementById('registerButton').addEventListener('click',enableButtons);

        // Task 4
        function PlayGame() {
            document.getElementById('gamearea').style.display="block";
            document.getElementById('accept').style.display="block";
            document.getElementById('next').style.display ="block";

            let num1 = Math.floor(Math.random() * 9) + 1;
            let num2 = Math.floor(Math.random() * 5) + 1;


            document.getElementById("num1").textContent = num1; 
            document.getElementById("num2").textContent = num2;
        }

       

        // Task 5  
        let startButton = document.getElementById("startButton");
        startButton.addEventListener("click", function() {
        PlayGame();
        
        document.getElementById("playArea").disabled = false;
        document.getElementById("answerInput").disabled = false;
        document.getElementById("acceptButton").disabled = false; 
        document.getElementById("nextButton").disabled = false;
        });

        // Task 6
        function CheckAnswer() {
            let num1 = parseInt(document.getElementById("num1").textContent);
            let num2 = parseInt(document.getElementById("num2").textContent);
            let actualAnswer = num1 * num2;

            let userAnswer = parseInt(document.getElementById("answerInput").value);

            let result = document.getElementById("result");
            if(userAnswer === actualAnswer) {
                result.textContent = "Correct!";
            } else {
                result.textContent = "Incorrect!";
            }

            // Append to PlayerRegistrationData
            let responseDetails = {
                    equation: num1 + " x " + num2,
                    response: userAnswer,
                    correctness: result.textContent
                };

            let currentUserEmail = document.getElementById('email').value;
            // Find the player in the PlayerRegistrationData array and add the response
            let playerIndex = PlayerRegistrationData.findIndex(player => player.email === currentUserEmail);
                if (playerIndex !== -1) {
                    PlayerRegistrationData[playerIndex].responses.push(responseDetails);
                }

                // Update localStorage
                localStorage.setItem("PlayerRegistrationData", JSON.stringify(PlayerRegistrationData));

            //Task 14  - Gabrielle Flash
            // Call showAllStats to display updated stats
            showAllStats();
           
        }
    function findPercentageScore() {
    let totalQuestions = 0;
    let correctAnswers = 0;
    let playerName = PlayerRegistrationData.length > 0 ? PlayerRegistrationData[0].firstName + " " + PlayerRegistrationData[0].lastName : "";

    // Counting total and correct questions
    PlayerRegistrationData.forEach(entry => {
        if (entry.correctness) {
            totalQuestions++;
            if (entry.correctness === "Correct!") {
                correctAnswers++;
            }
        }
    });

    // Calculating percentage score
    let percentageScore = totalQuestions > 0 ? (correctAnswers / totalQuestions) * 100 : 0;

    // Getting current date
    let today = new Date();
    let dd = String(today.getDate()).padStart(2, '0');
    let mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
    let yyyy = today.getFullYear();
    let currentDate = yyyy + '-' + mm + '-' + dd;

    // Clearing existing data
    let table = document.getElementById('showpercentage');
    table.innerHTML = ''; // This clears the table

    // Creating and appending new rows
    let newRow = table.insertRow();
    newRow.insertCell(0).innerText = playerName;
    newRow.insertCell(1).innerText = currentDate;
    newRow.insertCell(2).innerText = totalQuestions;
    newRow.insertCell(3).innerText = correctAnswers;
    newRow.insertCell(4).innerText = percentageScore.toFixed(2) + "%";
}
function endGame() {
    // Call findPercentageScore function
    findPercentageScore();

    // Clear the form and enable its inputs
    document.getElementById('registerForm').reset();
    document.getElementById('firstName').disabled = false;
    document.getElementById('lastName').disabled = false;
    document.getElementById('dob').disabled = false;
    document.getElementById('gender').disabled = false;
    document.getElementById('email').disabled = false;

    // Disable all buttons except the Register button
    document.getElementById('registerButton').disabled = false;
    document.getElementById('startButton').disabled = true;
    document.getElementById('endButtonForm').disabled = true;

    // Disable the Play and Results area
    document.getElementById('gamearea').style.display = 'none';
    displayAllPlayers();
}
   


function displayAllPlayers() {
    // Get the element where players will be displayed
    var displayArea = document.getElementById('showallplayers');

    // Clear any existing content
    displayArea.innerHTML = '';

    // Check if there are any players to display
    if (PlayerRegistrationData && PlayerRegistrationData.length > 0) {
        // Create a list or table element to hold player details
        var list = document.createElement('ul');

        // Iterate over each player and create an item for them
        PlayerRegistrationData.forEach(function(player, index) {
            var listItem = document.createElement('li');
            listItem.textContent = (index + 1) + ". " + player.firstName + " " + player.lastName + " - " + player.email;
            list.appendChild(listItem);
        });

        // Append the list to the display area
        displayArea.appendChild(list);
    } else {
        // Display a message if no players are registered
        displayArea.textContent = 'No players registered yet.';
    }
}

    //Task 13  - Gabrielle Flash
        // Function to display all player stats
        function showAllStats() {
        // Get the display area
        var displayArea = document.getElementById('showallplayers');

        // Clear the display area
        displayArea.innerHTML = '';

        // Check if there is data to display
        if (PlayerRegistrationData && PlayerRegistrationData.length > 0) {
            // Iterate over each player and display their stats
            PlayerRegistrationData.forEach(function (player, index) {
                var statsString =
                    "Name: " + player.firstName + ", " +
                    "Last Name: " + player.lastName + ", " +
                    "Age: " + player.age + ", " +
                    "Questions and Answers: " + player.equation + ", " +
                    "Status of the Answer: " + player.correctness + ", " +
                    "Percentage Score: " + calculatePercentageScore(player) + "%\n";

                // Create a new element to display player stats
                var statsElement = document.createElement('div');
                statsElement.textContent = statsString;

                // Append the element to the display area
                displayArea.appendChild(statsElement);
            });
        } else {
            // Display a message if no players are registered
            displayArea.textContent = 'No players registered yet.';
        }
    }

    // Function to calculate percentage score
    function calculatePercentageScore(player) {
        let totalQuestions = 0;
        let correctAnswers = 0;

        // Counting total and correct questions
        player.forEach(entry => {
            if (entry.correctness) {
                totalQuestions++;
                if (entry.correctness === "Correct!") {
                    correctAnswers++;
                }
            }
        });

        // Calculating percentage score
        let percentageScore = totalQuestions > 0 ? (correctAnswers / totalQuestions) * 100 : 0;

        return percentageScore.toFixed(2);
    }

        //Task 15 - Gabrielle Flash
        // Function to display frequency bar charts
        
        function showCharts() {
        // Get the display areas for the charts
        var genderChart = document.getElementById('genderChart');
        var percentageChart = document.getElementById('percentageChart');

        // Calculate frequency data
        var genderData = calculateGenderFrequency();
        var percentageData = calculatePercentageFrequency();

        // Displays gender chart
        displayBarChart(genderChart, 'Gender Distribution', genderData);

        // Displays percentage score chart
        displayBarChart(percentageChart, 'Percentage Score Distribution', percentageData);
    }

        // Function to calculate gender frequency
        function calculateGenderFrequency() {
            var genderFrequency = {
                male: 0,
                female: 0
            };

            var totalPersons = PlayerRegistrationData.length;

            // Counts gender frequencies
            PlayerRegistrationData.forEach(function (player) {
                if (player.gender === 'male') {
                    genderFrequency.male++;
                } 
                else if(player.gender === 'female') 
                {
                    genderFrequency.female++;
                } 
            });

            // Calculate percentages
            genderFrequency.malePercentage = (genderFrequency.male / totalPersons) * 100;
            genderFrequency.femalePercentage = (genderFrequency.female / totalPersons) * 100;
            

            return genderFrequency;
        }

        // Function to calculate percentage score frequency
        function calculatePercentageFrequency() {
            var percentageFrequency = {
                '<50%': 0,
                '50-59%': 0,
                '60-69%': 0,
                '70-79%': 0,
                '80-89%': 0,
                '90-99%': 0,
                '100%': 0,
            };

            var totalPersons = PlayerRegistrationData.length;

            // Count percentage score frequencies
            PlayerRegistrationData.forEach(function (player) {
                var percentageScore = calculatePercentageScore([player]);
                if (percentageScore < 50) {
                    percentageFrequency['<50%']++;
                } else if (percentageScore >= 50 && percentageScore <= 59) {
                    percentageFrequency['50-59%']++;

                    // Counts the number of ages between 50 and 59 inclusive
                    if (player.age >= 50 && player.age <= 59) {
                    // Increment the count for this age group
                    percentageFrequency['50-59%_Ages'] = (percentageFrequency['50-59%_Ages'] || 0) + 1;
                    }

                } else if (percentageScore >= 60 && percentageScore <= 69) {
                    percentageFrequency['60-69%']++;
                } else if (percentageScore >= 70 && percentageScore <= 79) {
                    percentageFrequency['70-79%']++;
                } else if (percentageScore >= 80 && percentageScore <= 89) {
                    percentageFrequency['80-89%']++;
                } else if (percentageScore >= 90 && percentageScore <= 99) {
                    percentageFrequency['90-99%']++;
                } else if (percentageScore === 100) {
                    percentageFrequency['100%']++;
                }
            });

            // Calculate percentages
            for (var key in percentageFrequency) {
                if (key !== '50-59%_Ages') {
                    percentageFrequency[key + '_Percentage'] = (percentageFrequency[key] / totalPersons) * 100;
                }
            }

            return percentageFrequency;
        }

        // Function to display a bar chart
        function displayBarChart(chartArea, chartTitle, chartData) {
            // Clears the chart area
            chartArea.innerHTML = '';

            // Creating a bar chart using HTML elements
            for (var key in chartData) {
                var bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.height = chartData[key] * 20 + 'px';
                bar.textContent = key + ': ' + chartData[key];
                chartArea.appendChild(bar);
            }
        }

        function showCharts() {
        // Get the containers for the charts
        var genderChartContainer = document.getElementById('genderChart');
        var percentageChartContainer = document.getElementById('percentageChart');

        // Clear the existing charts before creating new ones
        genderChartContainer.innerHTML = '';
        percentageChartContainer.innerHTML = '';

        // Calculate the frequencies and percentages
        var genderFrequency = calculateGenderFrequency();
        var percentageFrequency = calculatePercentageFrequency();

        // Function to create bar chart HTML for a category
        function createBarChartHTML(category, percentage, container) {
                var barContainer = document.createElement('div');
                barContainer.className = 'bar-chart';

                var barLabel = document.createElement('span');
                barLabel.textContent = category + ': ' + percentage + '%';

                var bar = document.createElement('div');
                bar.className = 'bar';
                bar.style.width = percentage + '%';
                bar.textContent = percentage > 5 ? percentage + '%' : ''; // Only show text if bar is wide enough

                barContainer.appendChild(barLabel);
                barContainer.appendChild(bar);

                container.appendChild(barContainer);
            }

        // Create gender bar chart
        createBarChartHTML('Male', genderFrequency.malePercentage, genderChartContainer);
        createBarChartHTML('Female', genderFrequency.femalePercentage, genderChartContainer);
        

        // Create percentage score bar chart
        for (var key in percentageFrequency) {
            if (!key.endsWith('_Percentage')) {
                createBarChartHTML(key, percentageFrequency[key + '_Percentage'], percentageChartContainer);
            }
        }
    }

        // Function to call and refresh showCharts() every 5 seconds
        function refreshCharts() {
            setInterval(function () {
                showCharts();
            }, 5000); // 5000 milliseconds (5 seconds)
        }

        // Call the refreshCharts() function when the page loads
        document.addEventListener('DOMContentLoaded', function () {
            // Starts calling and refreshing showCharts() every 5 seconds
            refreshCharts();

            // Gets the container for the charts
            var showChartsContainer = document.getElementById('showcharts');

            // Initial display of charts
            showChartsContainer.innerHTML = ''; // Clear any existing content
            showChartsContainer.innerHTML += '<h2>Charts</h2>';
            showChartsContainer.innerHTML += '<div id="genderChart" class="chart-container"></div>';
            showChartsContainer.innerHTML += '<div id="percentageChart" class="chart-container"></div>';

            // Call the showCharts() function initially
            showCharts();
        });
        document.getElementById('percentageScoreButton').addEventListener('click', function() {
    let currentUserEmail = document.getElementById('email').value; 
    findPercentageScore(currentUserEmail);
});

    </script>
    
</html>
